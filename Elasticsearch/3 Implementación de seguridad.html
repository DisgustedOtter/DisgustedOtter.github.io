
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.1">
    
    
      
        <title>Implementación de seguridad - Elastic Stack</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.23b6d78a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#implementacion-de-seguridad" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Elastic Stack" class="md-header__button md-logo" aria-label="Elastic Stack" data-md-component="logo">
      <img src="JygaLogo.png">
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Elastic Stack
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Implementación de seguridad
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Elastic Stack" class="md-nav__button md-logo" aria-label="Elastic Stack" data-md-component="logo">
      <img src="JygaLogo.png">
    </a>
    Elastic Stack
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../index.html" class="md-nav__link">
        Objetivo
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../2%20Previo%20a%20la%20instalacion.html" class="md-nav__link">
        Previo a la instalación del stack
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Beats
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Beats" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Beats
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Beats/1I%20ndex.html" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Beats/Filebeat.html" class="md-nav__link">
        Filebeat
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Beats/Winlogbeat.html" class="md-nav__link">
        Winlogbeat
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Elasticsearch
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Elasticsearch" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Elasticsearch
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="1%20Instalaci%C3%B3n.html" class="md-nav__link">
        Instalación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="2%20Configuraci%C3%B3n.html" class="md-nav__link">
        Configuración
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Implementación de seguridad
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="3%20Implementaci%C3%B3n%20de%20seguridad.html" class="md-nav__link md-nav__link--active">
        Implementación de seguridad
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#seguridad-minima" class="md-nav__link">
    Seguridad mínima
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport-layer-security-tls" class="md-nav__link">
    Transport Layer Security (TLS)
  </a>
  
    <nav class="md-nav" aria-label="Transport Layer Security (TLS)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-certificate-authority-ca" class="md-nav__link">
    Crear Certificate Authority (CA)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encriptar-la-comunicacion-intra-nodo-con-tls" class="md-nav__link">
    Encriptar la comunicación intra-nodo con TLS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Kibana
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kibana" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Kibana
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Kibana/4%20Kibana.html" class="md-nav__link">
        Instalación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Kibana/5%20Configuracion.html" class="md-nav__link">
        Configuración
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Kibana/6%20Seguridad.html" class="md-nav__link">
        Llave de encriptación y conexión segura a Elasticsearch
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Logstash
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Logstash" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Logstash
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Logstash/5%20Instalacion.html" class="md-nav__link">
        Instalación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../Logstash/6%20Configuraci%C3%B3n.html" class="md-nav__link">
        Configuración
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#seguridad-minima" class="md-nav__link">
    Seguridad mínima
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transport-layer-security-tls" class="md-nav__link">
    Transport Layer Security (TLS)
  </a>
  
    <nav class="md-nav" aria-label="Transport Layer Security (TLS)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-certificate-authority-ca" class="md-nav__link">
    Crear Certificate Authority (CA)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#encriptar-la-comunicacion-intra-nodo-con-tls" class="md-nav__link">
    Encriptar la comunicación intra-nodo con TLS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="implementacion-de-seguridad">Implementación de seguridad</h1>
<p>Cuando se Elasticsearch se utiliza para pruebas de desarrollo puede funcionar sin tener ningún tipo de seguridad, sin embargo cuando se tiene un despliegue en producción será necesario agregar capas de seguridad.</p>
<h2 id="seguridad-minima">Seguridad mínima</h2>
<p>Cuando se usa una licencia básica, las características de seguridad están deshabilitadas por defecto. Para habilitarlo realizar lo siguiente en cada nodo:</p>
<ul>
<li>
<p>Detener el servicio de Elasticsearch (si está corriendo), y se agregar el parametro <code>xpack.security.enabled: true</code> en el archivo <code>elasticsearch.yml</code></p>
</li>
<li>
<p>Iniciar el servicio de Elasticsearch
<img alt="Start Elasticsearch" src="image3.4.png" /></p>
</li>
<li>
<p>Crear una <em>Keystore</em> para elastic
<code>./bin/elasticsearch-keystore create -p</code>
<img alt="Create keystore elastic" src="image3.5.png" /></p>
</li>
<li>
<p>Se genera una contraseña para los <em>built-in users</em> de elastic, en otra terminal correr el comando <code>./bin/elasticsearch-setup-passwords interactive</code>
<img alt="Create built users" src="image3.6.png" /></p>
</li>
<li>
<p>Introducir la contraseña para cada usuario que se pida
<img alt="Set passsword for built users" src="image3.7.png" /></p>
</li>
<li>
<p>Ahora cada comunicación con Elasticsearch requerirá de credenciales:
<img alt="localhost:9200 credentials" src="image3.8.png" /></p>
</li>
</ul>
<p>En este punto sólo se ha configurado la seguridad minima, como el cluster cuenta con más de un nodo se debe configurar el <em>Transport Layer Security (TLS)</em>, de lo contrario el servicio no podrá iniciarse.</p>
<h2 id="transport-layer-security-tls">Transport Layer Security (TLS)</h2>
<p>El TLS maneja toda la comunicación interna entre los nodos del cluster, configurarlo previene que nodos no autorizados y/o maliciosos tengan comunicación con nuestro cluster.</p>
<h3 id="crear-certificate-authority-ca">Crear <em>Certificate Authority (CA)</em></h3>
<p>En Elasticsearch los nodos usan certificados para identificarse así mismos cuando se comunican con otros nodos. El cluster debe validar la autenticidad de estos certificados, la forma recomendada es utilizando un <em>Certificate Authority (CA)</em>, cuando un nodo es añadido al cluster debe usar un certificado firmado por el mismo CA.</p>
<ul>
<li>
<p>Generar un <em>Certificate Authority (CA)</em> <code>./bin/elasticsearch-certutil ca</code>
<img alt="generate CA" src="image3.9.png" /></p>
</li>
<li>
<p>El nombre por default es <code>elastic-stack-ca.p12</code>, se puede sobreescribir si se requiere, de lo contrario introducir <code>Enter</code>
<img alt="set name CA" src="image3.10.png" /></p>
</li>
<li>
<p>Introducir el password a utilizar                                   <br />
<img alt="set password CA" src="image3.11.png" /></p>
</li>
<li>
<p>Copiar en cada nodo el certificado en la dirección <code>C:\Program Files\elasticsearch-7.16.1\config\</code></p>
</li>
<li>
<p>Ahora se genera un certificado y llave privada para los nodos del cluster <code>./bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12</code>
<img alt="create certutil and private key" src="image3.12.png" /></p>
</li>
<li>
<p>Introducir la contraseña que se utilizó en el CA de los pasos anteriores
<img alt="put password for ca" src="image3.13.png" /></p>
</li>
<li>
<p>Renombrar si se desea, de lo contrario introducir <code>Enter</code>
<img alt="name cerificate" src="image3.14.png" /></p>
</li>
<li>
<p>Introducir password a usar para el certificado:
<img alt="password cerificate" src="image3.15.png" /></p>
</li>
<li>
<p>Se indicará la dirección donde fueron creados los archivos
<img alt="location cerificates" src="image3.16.png" /></p>
</li>
<li>
<p>Ubicar los certificados en la carpeta de configuración:
<img alt="location window cerificates" src="image3.17.png" /></p>
</li>
<li>
<p>Copiar los archivos y copiarlos en la misma dirección en cada nodo.</p>
</li>
</ul>
<h3 id="encriptar-la-comunicacion-intra-nodo-con-tls">Encriptar la comunicación intra-nodo con TLS</h3>
<p>Una vez generado los certificados, se habilita la configuración TLS. Realizar los siguientes pasos para cada nodo.</p>
<ul>
<li>
<p>En el archivo elasticsearch.yml agregar las siguientes líneas:</p>
<blockquote>
<p><code>xpack.security.transport.ssl.enabled: true</code>
<code>xpack.security.transport.ssl.verification_mode: certificate</code> 
<code>xpack.security.transport.ssl.client_authentication: required</code>
<code>xpack.security.transport.ssl.keystore.path: elastic-certificates.p12</code>
<code>xpack.security.transport.ssl.truststore.path: elastic-certificates.p12</code></p>
</blockquote>
</li>
<li>
<p>Agregar el password a la keystore:</p>
</li>
</ul>
<p><code>./bin/elasticsearch-keystore add xpack.security.transport.ssl.keystore.secure_password</code></p>
<p><code>./bin/elasticsearch-keystore add xpack.security.transport.ssl.truststore.secure_password</code></p>
<ul>
<li>Reiniciar el servicio de Elasticsearch.</li>
</ul>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="2%20Configuraci%C3%B3n.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Configuración" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Configuración
            </div>
          </div>
        </a>
      
      
        
        <a href="../Kibana/4%20Kibana.html" class="md-footer__link md-footer__link--next" aria-label="Next: Instalación" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Instalación
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../assets/javascripts/workers/search.c7dec7e7.min.js"}</script>
    
    
      <script src="../assets/javascripts/bundle.da79ceb7.min.js"></script>
      
    
  </body>
</html>